"""
Common Vulnerabilities Checker

Verifica vulnerabilidades comuns em websites.
"""

from typing import Dict, Any, List
import requests


class VulnerabilityChecker:
    """Checker para vulnerabilidades comuns"""

    def check(self, url: str) -> Dict[str, Any]:
        """
        Verificação de vulnerabilidades comuns

        Verifica:
        1. Cookies sem HttpOnly
        2. Sem HSTS
        3. Sem CSP
        4. Server header exposto
        5. X-Powered-By exposto

        Args:
            url: URL do website a verificar

        Returns:
            Dict com lista de vulnerabilidades encontradas
        """
        vulnerabilities = []

        try:
            response = requests.get(url, timeout=10)
            headers = response.headers
            cookies = response.cookies

            # Verificar cookies sem HttpOnly
            for cookie in cookies:
                if 'HttpOnly' not in str(cookie):
                    vulnerabilities.append("⚠️  Cookie sem flag HttpOnly")

            # Verificar HSTS
            if "Strict-Transport-Security" not in headers:
                vulnerabilities.append("⚠️  Sem HSTS header (man-in-the-middle risk)")

            # Verificar CSP
            if "Content-Security-Policy" not in headers:
                vulnerabilities.append("⚠️  Sem Content-Security-Policy (XSS risk)")

            # Verificar Server header exposto
            if "Server" in headers:
                vulnerabilities.append(f"⚠️  Server header exposto: {headers['Server']}")

            # Verificar X-Powered-By exposto
            if "X-Powered-By" in headers:
                vulnerabilities.append(f"⚠️  X-Powered-By exposto: {headers['X-Powered-By']}")

            return {"vulnerabilities": vulnerabilities}
        except Exception as e:
            return {"vulnerabilities": [f"Erro ao verificar: {str(e)}"]}
